# 批量运行多个分区数的使用说明

## 功能概述

现在的 `run_simulation.py` 支持批量运行不同的 METIS 分区数，无需手动修改配置文件。

## 使用方法

### 1. 使用默认分区数（4、8、16、32、64、128）

```bash
cd /home/zhangshangtong/Window_algorithm/BSGCN_Metis_Order
python run_simulation.py
```

这会自动运行 6 个配置（4、8、16、32、64、128 个分区）。

### 2. 指定自定义分区数

```bash
# 只运行特定的分区数
python run_simulation.py --partition 4 16 64

# 运行特定的分区数
python run_simulation.py --partition 8 32 128
```

### 3. 指定数据集

```bash
# 指定数据集并运行所有默认分区
python run_simulation.py --dataset proteins

# 指定数据集和特定分区
python run_simulation.py --dataset proteins --partition 4 8 16
```

## 输出文件结构

运行后会生成如下目录结构：

```
BSGCN_Metis_Order/
└── output/
    └── <dataset_name>/
        ├── Metis_4/
        │   └── simulation.log
        ├── Metis_8/
        │   └── simulation.log
        ├── Metis_16/
        │   └── simulation.log
        ├── Metis_32/
        │   └── simulation.log
        ├── Metis_64/
        │   └── simulation.log
        └── Metis_128/
            └── simulation.log
```

每个分区数的结果都保存在独立的目录中。

## 命令行参数

| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| `--dataset` | 数据集名称 | `proteins` | `--dataset proteins` |
| `--partition` | METIS分区数（可指定多个） | `4 8 16 32 64 128` | `--partition 4 8 16` |

## 示例

### 示例 1：运行默认配置

```bash
python run_simulation.py
```

输出：
```
Dataset: proteins
Partitions to run: [4, 8, 16, 32, 64, 128]
Total: 6 configurations

Loading dataset: proteins...
[运行6个配置...]

============================================================
All 6 simulations completed!
============================================================
```

### 示例 2：只运行4个分区和8个分区

```bash
python run_simulation.py --partition 4 8
```

### 示例 3：运行其他数据集

```bash
# 需要先在代码中添加数据集映射
python run_simulation.py --dataset cora --partition 4 8 16
```

## 工作原理

1. **加载数据一次**：只加载一次图数据
2. **循环运行**：对每个分区数运行完整的模拟
3. **临时修改配置**：每次运行前临时修改 `config.HDN_IDENTIFICATION['NUM_PARTITIONS']`
4. **保存结果**：每个分区数的结果保存在独立的目录中
5. **恢复配置**：运行后恢复原始配置

## 添加新的数据集

在 `run_simulation.py` 的 `main()` 函数中添加数据集映射：

```python
if args.dataset == 'proteins':
    dataset_dir = '/home/zhangshangtong/Window_algorithm/GCNAX/Nowtest/datasets/ogbn/'
    graph_name = 'proteins'
elif args.dataset == 'cora':
    dataset_dir = '/home/zhangshangtong/Window_algorithm/GCNAX/Nowtest/datasets/'
    graph_name = 'cora'
elif args.dataset == 'pokec':
    dataset_dir = '/home/zhangshangtong/Window_algorithm/GCNAX/Nowtest/datasets/txt_file/pokec/'
    graph_name = 'pokec'
# ... 添加更多数据集
```

## 优势

1. 73 **自动化**：无需手动修改配置
2. 73 **批量化**：一次运行多个配置
3. 73 **灵活**：可以指定任意分区数组合
4. 73 **高效**：数据只加载一次，每个配置共享
5. 73 **清晰**：结果分类存放，易于对比

## 注意事项

- 运行时间取决于数据大小和分区数
- 输出目录会自动创建
- 同一数据集和同一分区数的旧日志会被覆盖
- 建议先运行小数据集测试

